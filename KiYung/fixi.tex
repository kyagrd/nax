\chapter{System \Fixi}\label{ch:fixi}

It is known that primitive recursion is not embeddable in System \F\ since
induction is not derivable in second-order dependent type theory
\cite{Geuvers01}. For similar reasons, it is strongly believed that
primitive recursion is not embeddable in System \Fw. 
\citet{AbeMat04} designed \Fixw, an extension of \Fw\ with polarized kinds and
equi-recursive fixpoint type operator, in order to embed primitive recursion
over regular datatypes and type-indexed datatypes.
We present \Fixi, an extension of \Fixw\ with erasable term-indices,
to embed primitive recursion over term-indexed datatypes.

The organization of this chapter is analogous to the chapter on System \Fi\
(Chapter \ref{ch:fi}). Since the extensions from \Fixw\ to \Fixi\ is
basically the same as the extensions from \Fw\ to \Fi,
the description for \Fixi\ will be focused on the differences between \Fi.
Readers may refer back to Chapter \ref{ch:fi} for the details that are
in common with System~\Fi.

We describe syntax and typing rules in \S\ref{sec:fixi:def},
illustrate embeddings of primitive recursion for term-indexed datatypes
in \S\ref{sec:fixi:data}, and discuss the metatheory \S\ref{sec:fixi:theory}.


\section{System \Fixi} \label{sec:fixi:def}
The syntax and rules of System~\Fi\ are described in
Figures \ref{fig:Fixi}, \ref{fig:Fixi2} and~\ref{fig:eqFixi}.
The extensions new to System~\Fixi, which are not original part of
either System~\Fw\ or System~\Fixw\ are highlighted by either
\dbox{dashed boxes} or \newFi{\text{grey boxes}}.

The extensions, which are not originally part of System~\Fixw, are highlighted
by \newFi{\text{grey boxes}}. Those extensions in grey boxes are to support
term indexing.  Eliding all the grey boxes from Figures~\ref{fig:Fixi},
\ref{fig:Fixi2} and~\ref{fig:eqFixi},
one obtains a version of System~\Fixw\ with typing contexts separated into
two parts.\footnote{The original description of \Fixw \cite{AbeMat04} has
one combined typing context.}

The extensions, which are not originally part of System \Fw\ but
present in System~\Fixw, are highlighted by \dbox{dashed boxes}.
Those extensions in dashed boxes are to support equi-recursive types. 
Eliding all the dashed boxes, as well as all the grey boxes,
from Figures~\ref{fig:Fixi}, \ref{fig:Fixi2} and~\ref{fig:eqFixi}, one obtains
the Curry-style System \Fw\ with typing contexts separated into two parts.


\begin{figure}\begin{singlespace}
	\small
\paragraph{Syntax:}
\begin{align*}
\!\!\!\!\!\!\!\!&\text{Sort}
 	& \square
	\\
\!\!\!\!\!\!\!\!&\text{Term Variables}
 	& x,i
\\
\!\!\!\!\!\!\!\!&\text{Type Constructor Variables}
 	& X
\\
\!\!\!\!\!\!\!\!&\text{\dbox{Polarities}}
	& \dbox{$p$} &~ ::= + \mid - \mid \mathsf{0}
\\
\!\!\!\!\!\!\!\!&\text{Kinds}
 	& \kappa		&~ ::= ~ *
				\mid \dbox{$p\kappa$} -> \kappa
				\mid \newFi{A -> \kappa}
\\
\!\!\!\!\!\!\!\!&\text{Type Constructors}
	& A,B,F,G		&~ ::= ~ X
				\mid A -> B
				\mid \dbox{$\fix F$} \\ &&& ~\quad
				\mid \lambda \dbox{$X^{p\kappa}$}.F
				\mid F\,G
				\mid \forall X^\kappa . B \\ &&& ~\quad
				\mid \newFi{\lambda i^A.F
				\mid F\,\{s\}
				\mid \forall i^A . B}
\\
\!\!\!\!\!\!\!\!&\text{Terms}
	& r,s,t			&~ ::= ~ x \mid \lambda x.t \mid r\;s
\\
\!\!\!\!\!\!\!\!&\text{Typing Contexts}
	& \Delta		&~ ::= ~ \cdot
				\mid \Delta,\dbox{$X^{p\kappa}$}
				\mid \newFi{\Delta, i^A} \\
&	& \Gamma		&~ ::= ~ \cdot
				\mid \Gamma, x : A
\end{align*}
\paragraph{Reduction:} \fbox{$t \rightsquigarrow t'$}
\[ 
   \inference{}{(\lambda x.t)\,s \rightsquigarrow t[s/x]}
 ~~~~
   \inference{t \rightsquigarrow t'}{\lambda x.t \rightsquigarrow \lambda x.t'}
 ~~~~
   \inference{r \rightsquigarrow r'}{r\;s \rightsquigarrow r'\;s}
 ~~~~
   \inference{s \rightsquigarrow s'}{r\;s \rightsquigarrow r\;s'}
\]
~\\
\end{singlespace}
\caption{Syntax and Reduction rules of \Fixi}
\label{fig:Fixi}
\end{figure}

\begin{figure}\begin{singlespace}\small
\paragraph{Well-formed typing contexts:}
\[ \fbox{$|- \Delta$}
 ~~~~
   \inference{}{|- \cdot}
 ~~~
   \inference{|- \Delta & |- \kappa:\square}{|- \Delta,\dbox{$X^{p\kappa}$}}
      \big( X\notin\dom(\Delta) \big)
 ~~~ \newFi{
   \inference{|- \Delta & \cdot |- A:*}{|- \Delta,i^A}
      \big( i\notin\dom(\Delta) \big) }
\]
$ \fbox{$\Delta |- \Gamma$}
 ~~~~
   \inference{|- \Delta}{\dbox{$\mathsf{0}\Delta$} |- \cdot}
 ~~~~
   \inference{\Delta |- \Gamma & \Delta |- A:*}{
              \Delta |- \Gamma,x:A}
      \big( x\notin\dom(\Gamma) \big)
$ \vskip1ex ~
\paragraph{Sorting:} \fbox{$|- \kappa : \square$}
$ \quad
  \inference[($A$)]{}{|- *:\square}
 ~~~
   \inference[($R$)]{|- \kappa:\square & |- \kappa':\square}{
		     |- \dbox{$p\kappa$} -> \kappa' : \square}
 ~~~
   \newFi{
   \inference[($Ri$)]{\cdot |- A:* & |- \kappa:\square}{
                      |- A -> \kappa : \square} }
$
~\\
\paragraph{Kinding:} \fbox{$\Delta |- F : \kappa$}
$ \qquad
   \inference[($Var$)]{\dbox{$X^{p\kappa}$}\in\Delta & |- \Delta}{
 		       \Delta |- X : \kappa}
		\, \dbox{$(p\in \{+,\mathsf{0}\})$} $
\[
   \inference[($->$)]{\dbox{$-\Delta$} |- A : * & \Delta |- B : *}{
                      \Delta |- A -> B : * }
 \qquad \qquad \dbox{
   \inference[($\fix$)]{\Delta |- F : +\kappa -> \kappa}{
		      \Delta |- \fix F : \kappa } }
\]
\[
  \inference[($\lambda$)]{ |- \kappa:\square
                         & \Delta,\dbox{$X^{p\kappa}$} |- F:\kappa'}{
  	\Delta |- \lambda \dbox{$X^{p\kappa}$}.F : \dbox{$p\kappa$} -> \kappa'}
 ~~~~ \qquad
 \newFi{
  \inference[($\lambda i$)]{\cdot |- A:* & \Delta,i^A |- F : \kappa}{
			    \Delta |- \lambda i^A.F : A->\kappa} }
\]
\[
  \inference[($@$)]{ \Delta |- F : \dbox{$p\kappa$} -> \kappa'
		    & \dbox{$p\Delta$} |- G : \kappa }{
                     \Delta |- F\,G : \kappa'}
 ~~~~
 \newFi{
   \inference[($@i$)]{ \Delta |- F : A -> \kappa
   		     & \dbox{$\mathsf{0}\Delta$\!};\cdot |- s : A }{
		      \Delta |- F\,\{s\} : \kappa} }
\]
\[
   \inference[($\forall$)]{ |- \kappa:\square
   			  & \Delta,\dbox{$X^{\mathsf{0}\kappa}$} |- B : *}{
                           \Delta |- \forall X^\kappa . B : *}
 ~~~~ \qquad ~\,
	\newFi{
   \inference[($\forall i$)]{\cdot |- A:* & \Delta, i^A |- B : *}{
                             \Delta |- \forall i^A . B : *} }
\]
\[ \newFi{
   \inference[($Conv$)]{ \Delta |- A : \kappa
                       & \Delta |- \kappa = \kappa' : \square }{
                        \Delta |- A : \kappa'} }
\]
~\\
\paragraph{Typing:} \fbox{$\Delta;\Gamma |- t : A$}
$ \qquad
 ~~~~
 \inference[($:$)]{(x:A) \in \Gamma & \Delta |- \Gamma}{
                   \Delta;\Gamma |- x:A}
 ~~~~ \newFi{
   \inference[($:i$)]{i^A \in \Delta & \Delta |- \Gamma}{
                      \Delta;\Gamma |- i:A} }
$
\[
   \inference[($->$$I$)]{\Delta |- A:* & \Delta;\Gamma,x:A |- t : B}{
                         \Delta;\Gamma |- \lambda x.t : A -> B}
 ~~~~ ~~~~
   \inference[($->$$E$)]{\Delta;\Gamma |- r : A -> B & \Delta;\Gamma |- s : A}{
                         \Delta;\Gamma |- r\;s : B}
\]
\[ \inference[($\forall I$)]{|- \kappa:\square
			    & \Delta,\dbox{$X^{0\kappa}$\!};\Gamma |- t : B}{
                             \Delta;\Gamma |- t : \forall X^\kappa.B}
			    (X\notin\FV(\Gamma))
 ~~~~ ~~~~
   \inference[($\forall E$)]{ \Delta;\Gamma |- t : \forall X^\kappa.B
                            & \Delta |- G:\kappa }{
                             \Delta;\Gamma |- t : B[G/X]}
\]
\[ \newFi{
   \inference[($\forall I i$)]{\cdot |- A:* & \Delta, i^A;\Gamma |- t : B}{
                               \Delta;\Gamma |- t : \forall i^A.B}
   \left(\begin{matrix}
		i\notin\FV(t),\\
		i\notin\FV(\Gamma)\end{matrix}\right)
 ~~~~
   \inference[($\forall E i$)]{ \Delta;\Gamma |- t : \forall i^A.B
                              & \Delta;\cdot |- s:A}{
                               \Delta;\Gamma |- t : B[s/i]} }
\]
\[ \inference[($=$)]{\Delta;\Gamma |- t : A & \Delta |- A = B : *}{
                     \Delta;\Gamma |- t : B}
\]
\end{singlespace}
\caption{Sorting, Kinding, and Typing rules of \Fixi}
\label{fig:Fixi2}
\end{figure}

\begin{figure}\begin{singlespace}\small
\paragraph{Kind equality:} \fbox{$|- \kappa=\kappa' : \square$}
$ \quad
 ~~~~
   \inference{}{|- * = *:\square} $
\[
   \inference{ |- \kappa_1 = \kappa_1' : \square
             & |- \kappa_2 = \kappa_2' : \square }{
   |- \dbox{$p\kappa_1$}-> \kappa_2 = \dbox{$p\kappa_1'$}-> \kappa_2' : \square}
 ~~~~ \newFi{
   \inference{\cdot |- A=A':* & |- \kappa=\kappa':\square}{
              |- A -> \kappa = A' -> \kappa' : \square} }
\]
\[ \inference{|- \kappa=\kappa':\square}{
              |- \kappa'=\kappa:\square}
 ~~~~
   \inference{ |- \kappa =\kappa' :\square
             & |- \kappa'=\kappa'':\square}{
              |- \kappa=\kappa'':\square}
\]
~
\paragraph{Type constructor equality:} \fbox{$\Delta |- F = F' : \kappa$}
$\qquad \dbox{$
   \inference{\Delta|- F:+\kappa-> \kappa}{\Delta|- \fix F=F(\fix F):\kappa}$ } $
\[
   \inference{ \Delta,\dbox{$X^{p\kappa}$} |- F:\kappa'
   	     & \dbox{$p\Delta$} |- G:\kappa}{
	      \Delta |- (\lambda X^{p\kappa}.F)\,G = F[G/X]:\kappa'}
 ~~~~ \newFi{
   \inference{ \Delta,i^A |- F:\kappa
             & \dbox{$\mathsf{0}\Delta$\!};\cdot |- s:A}{
              \Delta |- (\lambda i^A.F)\,\{s\} = F[s/i]:\kappa} }
\]
\[ \inference{\Delta |- X:\kappa }{\Delta |- X=X:\kappa}
 ~~~~
   \inference{-\Delta |- A=A':* & \Delta |- B=B':*}{\Delta |- A-> B=A'-> B':*}
 ~~~~
   \inference{\Delta |- F=F' : +\kappa -> \kappa}{
	      \Delta |- \fix F = \fix F' : \kappa}
\]
\[
   \inference{ |- \kappa:\square
   	     & \Delta,\dbox{$X^{p\kappa}$} |- F=F' : \kappa'}{
   	\Delta |- \lambda \dbox{$X^{p\kappa}$}.F
		= \lambda \dbox{$X^{p\kappa}$}.F': \dbox{$\kappa$} -> \kappa'}
 ~~~~ ~
 \newFi{
   \inference{\cdot |- A:* & \Delta,i^A |- F=F' : \kappa}{
	      \Delta |- \lambda i^A.F=\lambda i^A.F' : A -> \kappa} }
\]
\[\!\!\!\!\!\!\!\!\!\!\!\!
   \inference{ \Delta |- F=F' : \dbox{$p\kappa$} -> \kappa'
   	     & \dbox{$p\Delta$} |- G=G':\kappa}{
              \Delta |- F\,G = F'\,G' : \kappa'}
 ~~~~
 \newFi{
   \inference{ \Delta |- F=F': A -> \kappa
             & \dbox{$\mathsf{0}\Delta$\!};\cdot |- s=s':A}{
	      \Delta |- F\,\{s\} = F'\,\{s'\} : \kappa} }
\]
\[
   \inference{ |- \kappa:\square
   	     & \Delta,\dbox{$X^{\mathsf{0}\kappa}$} |- B=B':*}{
              \Delta |- \forall X^\kappa.B=\forall X^\kappa.B':*}
 ~~~~ \quad
 \newFi{
   \inference{\cdot |- A:* & \Delta,i^A |- B=B':*}{
              \Delta |- \forall i^A.B=\forall i^A.B':*} }
\]
\[ \inference{\Delta |- F = F' : \kappa}{\Delta |- F' = F : \kappa}
 ~~~~
   \inference{\Delta |- F = F' : \kappa & \Delta |- F' = F'' : \kappa}{
              \Delta |- F = F'' : \kappa}
\]
~
\paragraph{Term equality:} \fbox{$\Delta;\Gamma |- t = t' : A$}
\[
   \inference{\Delta;\Gamma,x:A |- t:B & \Delta;\Gamma |- s:A}{
              \Delta;\Gamma |- (\lambda x.t)\,s=t[s/x] : B}
 ~~~~
   \inference{\Delta;\Gamma |- x:A}{\Delta;\Gamma |- x=x:A}
\]
\[ \inference{\Delta |- A:* & \Delta;\Gamma,x:A |- t=t':B}{
              \Delta;\Gamma |- \lambda x.t = \lambda x.t':B}
 ~~~~
   \inference{\Delta;\Gamma |- r=r':A-> B & \Delta;\Gamma |- s=s':A}{
              \Delta;\Gamma |- r\;s=r'\;s':B}
\]
\[ \inference{ |- \kappa:\square
	     & \Delta, \dbox{$X^{\mathsf{0}\kappa}$\!};\Gamma |- t=t' : B}{
              \Delta;\Gamma |- t=t' : \forall X^\kappa.B}
	     (X\notin\FV(\Gamma))
 ~~~~ ~~~~
   \inference{ \Delta;\Gamma |- t=t' : \forall X^\kappa.B
             & \Delta |- G:\kappa }{
              \Delta;\Gamma |- t=t' : B[G/X]}
\]
\[ \newFi{
   \inference{\cdot |- A:* & \Delta, i^A;\Gamma |- t=t' : B}{
              \Delta;\Gamma |- t=t' : \forall i^A.B}
   \left(\begin{smallmatrix}
		i\notin\FV(t),\\
		i\notin\FV(t'),\\
		i\notin\FV(\Gamma)\end{smallmatrix}\right)
 ~~~~
   \inference{ \Delta;\Gamma |- t=t' : \forall i^A.B
             & \Delta;\cdot |- s:A}{
              \Delta;\Gamma |- t=t' : B[s/i]} }
\]
\[ \inference{\Delta;\Gamma |- t=t':A}{\Delta;\Gamma |- t'=t:A}
 ~~~~
   \inference{\Delta;\Gamma |- t=t':A & \Delta;\Gamma |- t'=t'':A}{
              \Delta;\Gamma |- t=t'':A}
\]
\end{singlespace}
\caption{Equality rules of \Fixi}
\label{fig:eqFixi}
\end{figure}

TODO describe dashed box extensions TODO


\section{Embedding recursive datatypes and primitive recursion}
\label{sec:fixi:data}
Embedding for primitive recursion over datatypes of arbitrary polarities into
\Fixi\ was discovered by \citet{AbeMat04}. We review these embeddings
in the context of \Fixi.

The embeddings of non-recursive datatypes are exactly the same as in \Fi\ (see
\S\ref{sec:fi:data}), other than tracking polarities of the type constructor
variables. That is, we use the usual impredicative encodings for non-recursive
datatypes such as void, unit, pairs, sums, and existential types
(examples from \citet{AbeMat04}):
\begin{singlespace} \vskip-3ex
\begin{align*}
\bot &~\triangleq~ \forall X^{*}.X
	&:\;& *\\
\textsf{Unit} &~\triangleq~ \forall X.\lambda X^{\mathsf{0}*}. X
	&:\;& * \\
\times &~\triangleq~
	\l X_1^{+*}.\l X_2^{+*}.\forall X^{*}.(X_1 -> X_2 -> X) -> X
	&:\;& +* -> +* -> * \\
+ &~\triangleq~
	\lambda X_1^{+*}.\l X_2^{+*}.\forall X^{*}.(X_1 -> X) -> (X_2 -> X) -> X
	&:\;& +* -> +* -> * \\
\exists_\kappa &~\triangleq~
	\l X_{\!F}^{\mathsf{0}\kappa -> *}.\forall X^{*}.
		(\forall X_1^\kappa.X_{\!F}\,X_1 -> X) -> X
	&:\;& +(\textsf{0}\kappa -> *) -> *
\end{align*}
\end{singlespace}

Embedding recursive datatypes and their Mendler-style primitive recursion
amounts to embedding $\mu_\kappa$, $\In_\kappa$, and $\MPr_\kappa$ described
in \S\ref{sec:mpr}. Figure~\ref{fig:embedMPr} illustrates the embeddings
discovered by \citet{AbeMat04}, reformatted using our conventions (see
Figure~\ref{fig:mu} in \S\ref{ssec:embedTwoLevel}) and taking term-indices
into consideration. To confirm the correctness of these embeddings,
we should check that (1) the embeddings are well-kinded and well-typed
and that (2) the primitive recursion behaves well
(\ie, $\MPr_\kappa\;s\;(\In_\kappa) -->+ s\;\textit{id}\;(\MPr_\kappa\;s)\;t$).
From the term encodings of $\MPr_\kappa$ and $\In_\kappa$, it is obvious that
the reduction of primitive recursion behaves well. Thus, we only need to check
that $\mu_\kappa$ is well-kinded and $\MPr_\kappa$ and $\In_\kappa$ are
well-typed.
\begin{landscape}
\begin{figure}
\begin{singlespace}
\begin{multline*} \text{notation:}\quad
   \boldsymbol{\l}\mathbb{I}^\kappa.F =
	\lambda I_1^{K_1}.\cdots.\lambda I_n^{K_n}.F \qquad
   \boldsymbol{\forall}\mathbb{I}^\kappa.B =
	\forall I_1^{K_1}.\cdots.\forall I_n^{K_n}.B \qquad
   F\mathbb{I} = F I_1 \cdots I_n \qquad
   F \stackrel{\kappa}{\pmb{\pmb{->}}} G =
	\boldsymbol{\forall}\mathbb{I}^\kappa.F\mathbb{I} -> G\mathbb{I} \\
\begin{array}{lll}
\text{where}
 	& \kappa = K_1 -> \cdots -> K_n -> * & \text{and} ~~~
 	\text{$I_i$ is an index variable ($i_i$) when $K_i$ is a type,}
 		\\
 	& \mathbb{I}\,=I_1,\;\dots\;\dots\;,\;I_n& \qquad~\qquad
		\text{a type constructor variable ($X_i$) otherwise
			(\ie, $K_n=p_i\kappa_i$).}
\end{array}
\end{multline*} ~ \vspace*{-5pt}
\hrule  \vspace*{-2pt}
\begin{align*}
\mu_\kappa &\;:~ \mathsf{0}(\mathsf{0}\kappa -> \kappa) -> \kappa \\
\mu_\kappa &\triangleq
\l X_{\!F}^{\mathsf{0}(\mathsf{0}\kappa -> \kappa)}.\fix(\Phi_\kappa\,X_{\!F})\\
\Phi_\kappa &\;:~ \mathsf{0}(\mathsf{0}\kappa -> \kappa) -> +\kappa -> \kappa \\
\Phi_\kappa &\triangleq \l X_{\!F}^{\mathsf{0}(\mathsf{0}\kappa -> \kappa)}.
\l X'^{+\kappa}.\boldsymbol{\l}\mathbb{I}^\kappa.
\forall X_{\!G}^\kappa.
(\forall X^\kappa. (X \karrow{\kappa} X')
		-> (X \karrow{\kappa} G)
		-> X_{\!F}\,X \karrow{\kappa} X_{\!G} ) -> X_{\!G}\,\mathbb{I}\\
~\\
\MPr_\kappa &\;:~
	\forall X_{\!F}^{\kappa-> \kappa}.\forall X^\kappa.
	(\forall {X_r}^{\!\!\kappa}.
	 (X_r \karrow{\kappa} \mu_\kappa X_{\!F}) ->
	 (X_r \karrow{\kappa} X) ->
	 (X_{\!F}\,X_r \karrow{\kappa} X) ) ->
	 (\mu_\kappa X_{\!F} \karrow{\kappa} X) \\
\MPr_\kappa &\triangleq \l s.\l r.r\;s \\
~\\
\In_\kappa &\;:~ \forall X_{\!F}^{\kappa-> \kappa}.
		X_{\!F}(\mu_\kappa X_{\!F}) \karrow{\kappa} \mu_\kappa X_{\!F}
\In_\kappa &\triangleq \l t.\l s.s\;\textit{id}\;(\MPr_\kappa\;s)\;t \\
\textit{id} &\triangleq \l x.x
\end{align*}
\end{singlespace}
\caption{Embedding of the recursive operators ($\mu_\kappa$),
	their data constructors ($\In_\kappa$),
	and the Mendler-style primitive recursors ($\MPr_\kappa$) in \Fixi.}
\label{fig:embedMPr}
\end{figure}
\end{landscape}

Note that the polarities appearing in the embedding of $\mu_\kappa$ are all
$\mathsf{0}$. The embedding from a non-polarize kind $\kappa$ into
a polarize kinds $\ulcorner\kappa\urcorner$ can be defined as:
\[ \ulcorner * \urcorner = * \qquad
\ulcorner \kappa_1 -> \kappa_2 \urcorner =
\mathsf{0}\ulcorner\kappa_1\urcorner -> \ulcorner\kappa_2\urcorner \qquad
\ulcorner A -> \kappa \urcorner = A -> \ulcorner \kappa \urcorner.
\]
It is easy to see that the embedding of the non-polarized recursive
type operator $\mu_\kappa : \mathsf{0}(\mathsf{0}\kappa -> \kappa) -> \kappa$
is well-kinded, provided that
$\Phi_\kappa : \mathsf{0}(\mathsf{0}\kappa -> \kappa) -> +\kappa -> \kappa$
is well kinded. Note that $\Phi_\kappa$ turns an avariant type constructor
($\mathsf{0}\kappa -> \kappa$) into a positive type constructor
($+\kappa -> \kappa$). From the definition of $\Phi_\kappa$, we only need 
to check that $X \karrow{\kappa} X'$, $(X \karrow{\kappa} G)$,
$X_F\,X \karrow{\kappa} -> X$ and $X_G\;\mathbb{I}$ are of kind $*$,
which is not difficult to see.

TODO $\mu_\kappa$ TODO

We leave checking well-typedness of $\In_\kappa$ as an exercise for the reader
since it is straightforward once we know the type of $\MPr_\kappa$.


\section{Metatheory} \label{sec:fixi:theory}

We can prove strong normalization of \Fixi\ by erasing term-indices in \Fixi\ 
types into \Fixw\ types. Since \Fixw\ is strongly normalizing \cite{AbeMat04},
the existence of a index erasure that maps a valid typing judgment on a term
in \Fixi\ to a valid typing judgment on the same term in \Fixw\ implies
strong normalization of \Fixi.

The definition of the index erasure operation and the proofs for
the related theorems are almost exactly the same as their counterparts
in System \Fi\ (see \S\ref{sec:fi:theory}). So, we simply illustrate
the definition and just give a very brief sketch of the proofs for the
theorems.

We define a meta-operation of index erasure that projects $\Fixi$ types
to $\Fixw$ types.
\begin{definition}[index erasure]\label{def:Fixierase}
\[ \fbox{$\kappa^\circ$}
 ~~~~ ~~
 *^\circ =
 *
 ~~~~ ~~
 (p\kappa_1 -> \kappa_2)^\circ =
 p{\kappa_1}^\circ -> {\kappa_2}^\circ
 ~~~~ ~~
 (A -> \kappa)^\circ =
 \kappa^\circ
\]
\[ \fbox{$F^\circ$}
 ~~~~
 X^\circ =
 X
 ~~~~ ~~~~
 (A -> B)^\circ =
 A^\circ -> B^\circ
 ~~~~ ~~~~
 (\mu F)^\circ =
 \mu F^\circ
\]
\[ \qquad
 (\lambda X^{p\kappa}.F)^\circ =
 \lambda X^{p\kappa^\circ}.F^\circ
 ~~~~ ~~~~
 (\lambda i^A.F)^\circ =
 F^\circ
\]
\[ \qquad
 (F\;G)^\circ =
 F^\circ\;G^\circ
 ~~~~ ~~~~ ~~~~ ~~~~ ~~
 (F\,\{s\})^\circ =
 F^\circ
\]
\[ \qquad
 (\forall X^\kappa . B)^\circ =
 \forall X^{\kappa^\circ} . B^\circ
 ~~~~ ~~~~
 (\forall i^A . B)^\circ =
 B^\circ
\]
\[ \fbox{$\Delta^\circ$}
 ~~~~
 \cdot^\circ = \cdot
 ~~~~ ~~
 (\Delta,X^{p\kappa})^\circ = \Delta^\circ,X^{p\kappa^\circ}
 ~~~~ ~~
 (\Delta,i^A)^\circ = \Delta^\circ
\]
\[ \fbox{$\Gamma^\circ$}
 ~~~~
 \cdot^\circ = \cdot
 ~~~~ ~~~~
 (\Gamma,x:A)^\circ = \Gamma^\circ,x:A^\circ
\]
\end{definition}

\begin{theorem}[index erasure on well-sorted kinds]
\label{thm:Fixierasesorting}
	$\inference{|- \kappa : \square}{|- \kappa^\circ : \square}$
\end{theorem}

\begin{theorem}[index erasure on well-formed type level contexts]
\label{thm:Fixierasetyctx}
\[ \inference{|- \Delta}{|- \Delta^\circ} \]
\end{theorem}

\begin{theorem}[index erasure on kind equality]\label{thm:Fixierasekindeq}
$ \inference{|- \kappa=\kappa':\square}
	{|- \kappa^\circ=\kappa'^\circ:\square}
$
\end{theorem}

\begin{theorem}[index erasure on well-kinded type constructors]
\label{thm:Fixierasekinding}
\[ \inference{|- \Delta & \Delta |- F : \kappa}
		{\Delta^\circ |- F^\circ : \kappa^\circ}
\]
\end{theorem}
\begin{theorem}[index erasure on type constructor equality]
\[ \inference{\Delta |- F=F':\kappa}
		{\Delta^\circ |- F^\circ=F'^\circ:\kappa^\circ}
\]
\label{thm:Fixierasetyconeq}
\end{theorem}

\begin{theorem}[index erasure on well-formed term level contexts]
\label{thm:Fixierasetmctx}
\[ \inference{\Delta |- \Gamma}{\Delta^\circ |- \Gamma^\circ} \]
\end{theorem}

\begin{theorem}[index erasure on index-free well-typed terms]
\label{thm:Fixierasetypingifree}
\[ \inference{ \Delta |- \Gamma & \Delta;\Gamma |- t : A}
		{\Delta^\circ;\Gamma^\circ |- t : A^\circ}
		{\enspace(\dom(\Delta)\cap\FV(t) = \emptyset)}
\]
\end{theorem}


We introduce an index variable selection meta-operation that selects all
the index variable bindings from the type level context.
\begin{definition}[index variable selection]
\[ \cdot^\bullet = \cdot \qquad
	(\Delta,X^{p\kappa})^\bullet = \Delta^\bullet \qquad
	(\Delta,i^A)^\bullet = \Delta^\bullet,i:A
\]
\end{definition}

\begin{theorem}[index erasure on well-formed term level contexts
		prepended by index variable selection]
\label{thm:Fixierasetmctxivs}
\[ \inference{\Delta |- \Gamma}{\Delta^\circ |- (\Delta^\bullet,\Gamma)^\circ}
\]
\end{theorem}

\begin{theorem}[index erasure on well-typed terms]
\label{thm:Fixierasetypingall}
\[ \inference{\Delta |- \Gamma & \Delta;\Gamma |- t : A}
		{\Delta^\circ;(\Delta^\bullet,\Gamma)^\circ |- t : A^\circ}
\]
\end{theorem}

