\section{System \F} \label{sec:f}
\begin{figure}
\begin{singlespace}
\begin{minipage}{.46\textwidth}
	\begin{center}Church-style\end{center}
\def\baselinestretch{0}
\small
\begin{align*}
\textbf{term syntax} \\
t,s ::= &~ x           & \text{variable}    \\
      | &~ \l(x:A) . t & \text{abstraction} \\
      | &~ t ~ s       & \text{application} \\
      | &~ \L X    . t & \text{type abstraction} \\
      | &~ t [A]       & \text{type application} \\
\\
\textbf{type syntax} \\
A,B ::= &~ X           & \text{variable type}   \\
      | &~ A -> B      & \text{arrow type} \\
      | &~ \forall X.B & \text{forall type}   \\
\end{align*}
\[ \textbf{kinding \& typing contexts} \]\vspace*{-1em}
\begin{align*}\quad
\Delta ::= &~ \cdot \\
	 | &~ \Delta, x:A & (X\notin \dom(\Delta)) \\
\Gamma ::= &~ \Delta;\cdot \\
	 | &~ \Delta;\Gamma, x:A & (x\notin \dom(\Gamma)) \\
\end{align*}
\[ \textbf{kinding rules} \quad \framebox{$ \Delta |- A $} \]\vspace*{-1em}
\begin{align*}
& \inference[\sc TVar]{X \in \Delta}{\Delta |- X} \\
& \inference[\sc TArr]{\Delta |- A & \Delta |- B}{\Delta |- A -> B} \\
& \inference[\sc TAll]{\Delta,X |- B}{\Delta |- \forall X.B} \\
\end{align*}
\[ \textbf{typing rules} \quad \framebox{$ \Delta;\Gamma |- t : A $ } \]
\vspace*{-1em}
\begin{align*}
& \inference[\sc Var]{x:A \in \Gamma}{\Delta;\Gamma |- x:A} \\
& \inference[\sc Abs]{\Delta |- A & \Delta;\Gamma,x:A |- t : B}
	             {\Delta;\Gamma |- \l(x:A).t : A -> B} \\
& \inference[\sc App]{\Delta;\Gamma |- t : A -> B & \Delta;\Gamma |- s : A}
		     {\Delta;\Gamma |- t~s : B} \\
& \inference[\sc TyAbs]{\Delta,X;\Gamma |- t : B}
		       {\Delta;\Gamma |- \L X.t : \forall X.B} ~
		       (X\notin\ran(\Gamma)) \\
& \inference[\sc TyApp]{\Delta;\Gamma |- t : \forall X.B & \Delta |- A}
		       {\Delta;\Gamma |- t[A] : B[A/X]}
\end{align*}
\end{minipage}
\begin{minipage}{.46\textwidth}
	\begin{center}Curry-style\end{center}
\def\baselinestretch{0}
\small
\begin{align*}
\textbf{term syntax} \\
t,s ::= &~ x           \\
      | &~ \l x    . t \\
      | &~ t ~ s       \\
      \phantom{|} &~ \\
      \phantom{|} &~ \\
\\
\textbf{type syntax} \\
A,B ::= &~ X \\
      | &~ A -> B \\
      | &~ \forall X . B \\
\end{align*}
\[ \textbf{kinding \& typing contexts} \]\vspace*{-1em}
\begin{align*}\quad
\Delta ::= &~ \cdot \\
	 | &~ \Delta, x:A & (X\notin \dom(\Delta)) \\
\Gamma ::= &~ \cdot \\
	 | &~ \Gamma, x:A & (x\notin \dom(\Gamma)) \\
\end{align*}
\[ \textbf{kinding rules} \quad \framebox{$ \Delta |- A $}\]\vspace*{-1em}
\begin{align*}
& \inference[\sc TVar]{X \in \Delta}{\Delta |- X} \\
& \inference[\sc TArr]{\Delta |- A & \Delta |- B}{\Delta |- A -> B} \\
& \inference[\sc TAll]{\Delta,X |- B}{\Delta |- \forall X.B} \\
\end{align*}
\[ \textbf{typing rules} \quad \framebox{$ \Delta;\Gamma |- t : A $ } \]
\vspace*{-1em}
\begin{align*}
& \inference[\sc Var]{x:A \in \Gamma}{\Delta;\Gamma |- x:A} \\
& \inference[\sc Abs]{\Delta |- A & \Delta;\Gamma,x:A |- t : B}
		     {\Delta;\Gamma |- \l x   .t : A -> B} \\
& \inference[\sc App]{\Delta;\Gamma |- t : A -> B & \Delta;\Gamma |- s : A}
		     {\Delta;\Gamma |- t~s : B} \\
& \inference[\sc TyAbs]{\Delta,X;\Gamma |- t : B}
		       {\Delta;\Gamma |- t : \forall X.B} ~
		       (X\notin\ran(\Gamma)) \\
& \inference[\sc TyApp]{\Delta;\Gamma |- t : \forall X.B & \Delta |- A}
		       {\Delta;\Gamma |- t : B[A/X]}
\end{align*}
\end{minipage}
~\\
\caption{System \F\ in Church-style and Curry-style}
\label{fig:f}
\end{singlespace}
\end{figure}


TODO explain what extension we have made from STLC to F

TODO encoding of polymorphic regular recursive datatypes is possible

TODO compare curry style and church style


\subsection{Subject reduction and strong normalization}\label{sec:f:srsn}
To discuss subject reduction, we need to know what are the reduction rules
for System \F, which is missing for Figure \ref{fig:f}.

The reduction rules for the Church-style System \F\ has all the reduction rules
for the Church-style STLC, and, in addition, three more reduction rules
(\rulename{RedTy}, \rulename{RedTyAbs}, and \rulename{RedTyApp}) involving
type abstractions and type applications. The following is the list of
reduction rules for the Church-style System \F:
\begin{align*}
& \inference[\sc RedBeta]{}{(\l(x:A).t)~s --> t[s/x]}
&&\inference[\sc RedTy]{}{(\L X   .t)[A] --> t[A/X]} \\
& \inference[\sc RedAbs]{t --> t'}{\l x   .t --> \l x   .t'}
&&\inference[\sc RedTyAbs]{t --> t'}{\L X   .t --> \L X   .t'} \\
& \inference[\sc RedApp1]{t --> t'}{t~s --> t'~s}
&&\inference[\sc RedTyApp]{t --> t'}{t[A] --> t'[A]} \\
& \inference[\sc RedApp2]{s --> s'}{t~s --> t~s'}
\end{align*}

The reduction rules for Curry-style System \F\ is exactly the same as
the reduction rules for the Curry-style STLC (repeated below),
since the terms of the Curry-style System \F\ and STLC are identical.
\vspace*{-.7em}
\begin{align*}
& \inference[\sc RedBeta]{}{(\l x   .t)~s --> t[s/x]} \\
& \inference[\sc RedAbs]{t --> t'}{\l x   .t --> \l x   .t'} \\
& \inference[\sc RedApp1]{t --> t'}{t~s --> t'~s} \\
& \inference[\sc RedApp2]{s --> s'}{t~s --> t~s'}
\end{align*}

The subject reduction theorem for System \F\ can be stated as follows:
\begin{theorem}[subject reduction]
$\inference{\Delta;\Gamma |- t : A  & t --> t'}{\Delta;\Gamma |- t' : A}$
\end{theorem}
We can prove subject reduction for the System \F\, in a similar fashion
to the proof of subject reduction for STLC,
by induction on the derivation of the reduction rules.

In Church style, proof for all other cases except for the rules
\rulename{RedBeta} and \rulename{RedTy} are simply done by applying
the induction hypothesis. We use the substitution lemma for proving
the \rulename{RedBeta} case and the type substitution lemma for
proving the \rulename{RedTy} case. The substitution lemma and
the type substitution lemma are stated below:

\begin{lemma}[substitution]
$ \inference{\Delta;\Gamma,x:A |- t : B  & \Delta;\Gamma |- s : A}
	{\Delta;\Gamma |- t[s/x] : B} $
\end{lemma}

\begin{lemma}[type substitution]
$ \inference{\Delta,X;\Gamma |- t : B  & \Delta |- A}
	{\Delta;\Gamma |- t[A/X] : B[A/X]} ~ (X\notin\ran(\Gamma))$
\end{lemma}

In Curry style, the most interesting case is the \rulename{RedBeta} rule,
which we the substitution lemma to prove.
The other rules 
The only complication we have,
compared to STLC, is that the typing rules are not syntax directed 

The most interesting case of the proof is, of course,
the \rulename{RedBeta} rule.


Other cases




Church-style

\paragraph{Strong normalization}

\begin{figure}
\begin{singlespace}
\begin{description}
\item[Interpretation of types] as saturated sets of normalizing terms
	whose free type variables are substituted according to
	the given type valuation ($\xi$):
\begin{align*}
[| X |]_\xi           &= \xi(X) \\ 
[| A -> B |]_\xi      &= [|A|]_\xi -> [|B|]_\xi \\
[| \forall X.B |]_\xi &= [|B|]_\xi \qquad\qquad\qquad (X\notin\dom(\xi))
\end{align*}
\item[Interpretation of kinding and typing contexts]
		       as sets of type and term valuations ($\xi$ and $\rho$):
\begin{align*}
[| \Delta        |] &= \dom(\Delta) -> \SAT \\
[| \Delta;\Gamma |] &= \{ \xi;\rho \mid \xi\in[|\Delta|], \rho\in[|\Gamma|]_\xi \} \\
[| \Gamma        |]_\xi\ &= \{ \rho : \dom(\Gamma) -> \SN \mid \rho(x)=[|\Gamma(x)|]_\xi ~\text{for all}~x\in\dom(\Gamma) \}
\end{align*}
\item[Interpretation of terms] as terms themselves whose free variables are
	substitued according to the given pair of valuations ($\xi$;$\rho$):
\begin{align*}
[| x      |]_{\xi;\rho} &= \rho(x) \\
[| \l x.t |]_{\xi;\rho} &= \l x . [|t|]_{\xi;\rho} \qquad (x\notin\dom(\rho)) \\
[| t ~ s  |]_{\xi;\rho} &= [| t |]_{\xi;\rho} ~ [| s |]_{\xi;\rho}
\end{align*}
\end{description}
\caption[Interpretation of System \F\ for proving strong normalization]
	{Interpretation of types, typing contexts, and terms of System \F\
         for the proof of strong normalization}
\label{fig:interpF}
\end{singlespace}
\end{figure}

\begin{theorem}[soundness of typing]
$ \inference{\Delta;\Gamma|- t:A & \xi;\rho \in [|\Delta;\Gamma|]}
	    {[|t|]_{\xi;\rho} \in [|A|]_\xi} $
\end{theorem}
\begin{proof}
\end{proof}

\begin{corollary}[strong normalization]
	$\inference{\Delta;\Gamma |- t : A}{t \in \SN}$
\end{corollary}

